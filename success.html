<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Autenticação concluída</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
  <h2>Autenticando...</h2>

  <script>
    const t = TrelloPowerUp.iframe();

    const tokens = JSON.parse(localStorage.getItem('googleTokens'));

    if (tokens) {
      t.set('member', 'shared', 'googleTokens', tokens)
        .then(() => {
          document.body.innerHTML = '<h3>Autenticação concluída com sucesso. Você pode fechar esta aba.</h3>';
        })
        .catch(err => {
          console.error(err);
          document.body.innerHTML = '<h3>Erro ao salvar token.</h3>';
        });
    } else {
      document.body.innerHTML = '<h3>Tokens não encontrados.</h3>';
    }
  </script>
</body>
</html>
